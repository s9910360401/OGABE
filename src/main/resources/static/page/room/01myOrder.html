<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>會員訂單明細</title>
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.min.css" />
  <!-- AOS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/3.0.0-beta.6/aos.css"
    integrity="sha512-hoGlO+71fSG6lgS60I4bKvsFVB+bAnrVFDYlwSXoyNLppDcoupwJB7KbWq/63iACKn3gcgK9jMXd+T+YDeVrGQ=="
    crossorigin="anonymous" />
  <!-- bootstrap -->
  <link rel="stylesheet" type="text/css" href="../../styles/bootstrap4/bootstrap.min.css" />
  <!-- font-awesome -->
  <link href="../../plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <!-- breadcrumbs -->
  <link rel="stylesheet" type="text/css" href="../../styles//breadcrumbs.css" />
  <!-- base css -->
  <link rel="stylesheet" type="text/css" href="../../styles/base.css" />
  <!-- room css -->
  <link rel="stylesheet" type="text/css" href="../../styles/room/room.css" />
</head>
<style>
  .comment {
    font-size: 40px;
    color: orange;
    height: 50px;

  }

  .comment li {
    float: left;
    cursor: pointer;
  }

  ul {
    list-style: none;
  }
</style>

<body>
  <!-- Header -->
  <div id="header"></div>
  <!-- Header -->
  <div class="container body">
    <!-- Breadcrumbs_start -->
    <div class="row">
      <div class="col">
        <div class="breadcrumbs d-flex flex-row align-items-center">
          <ul>
            <li><a href="index.html">首頁</a></li>
            <li><a href="./myroom.html"><i class="fa fa-angle-right" aria-hidden="true"></i>會員中心</a></li>
            <li class="active"><a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i>旅館訂單明細</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Breadcrumbs_end -->
    <div>
      <h1 class="table-title">旅館訂單明細</h1>
      <div class="table-responsive">
        <table class="table table-hover" id="table-data">
          <thead>
            <tr>
              <th>訂單編號</th>
              <th>房型名稱</th>
              <th>訂單日期</th>
              <th>訂單金額</th>
              <th>訂單狀態</th>

            </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>

  </div>
  <!-- Footer_start -->
  <div id="footer"></div>
  <!-- Footer_end -->
  <!-- Modal_start -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="exampleModalLabel">預訂頁面</h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="exampleInputPassword1" class="form-label">房型名稱</label>
              <input type="text" class="form-control" id="exampleInputPassword1" disabled value="K21321321" />
            </div>
            
          
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            取消
          </button>
          <button id="success" type="button" class="btn btn-primary">
            送出
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal_end -->
  </div>
</body>

</html>
<!-- 引入 header / footer /scrollTop-->
<script>
  $(function () {
    $("#header").load("../../header.html");
    $("#footer").load("../../footer.html");
    $("#scrollTop").load("../../scrollTop.html");

  });
</script>
<!-- Ａos 淡入淡出特效_start -->
<script type="module">

  function refresh_chart(str_cameo_motion_component_tag_name) {
    console.log("str_cameo_motion_component_tag_name");
    console.log(str_cameo_motion_component_tag_name);
    let cameo_motion_component = document.getElementsByTagName(
      str_cameo_motion_component_tag_name)[0];
    console.log("cameo_motion_component");
    console.log(cameo_motion_component);
    console.log("cameo_motion_component.chart");
    console.log(cameo_motion_component.chart);
    cameo_motion_component.chart.appear();
    cameo_motion_component.chart.series.each(function (series) {
      series.appear();
    });
  }

  AOS.init({
    duration: 1000, // values from 0 to 3000, with step 50ms
    offset: 90 // offset (in px) from the original trigger point

  });
  $(function () {
    var winHeight = $(window).height();
    $(".scrolldown").on("click", function () {
      $("html,body").stop(true, false).animate(
        {
          scrollTop: winHeight
        },
        800
      );
      return false;
    });
  });
  let ary_charts = [
    "cameo-divergent-stacked-bars",
    "cameo-run",
    "cameo-line",
    "cameo-rank",
    "cameo-multi-axis-prediction",
    "cameo-map-tw"
  ];
  for (let i = 1; i <= ary_charts.length; i++) {
    let str_aos = "aos:in:chart-" + i;
    document.addEventListener(str_aos, ({ detail }) => {
      refresh_chart(ary_charts[i - 1]);
    });
  }
</script>
<!-- Ａos 淡入淡出特效_end -->
<!-- jquery -->
<script src="../../js/jquery-3.2.1.min.js"></script>
<!-- bootstrap -->
<script src="../../styles/bootstrap4/popper.js"></script>
<script src="../../styles/bootstrap4/bootstrap.min.js"></script>
<!-- 輪播 -->
<script src="../../plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
<!-- SweetAlert2 -->
<script src="../../alert.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.all.min.js"></script>
<!-- AOS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/3.0.0-beta.6/aos.js"
  integrity="sha512-tnNM6PPNOVfZ5sGPw6hThCrcUBeqt2mVEk3EAj8tCtuMHqbuVm5/HsZagrr8W2aaFE+6rKIByGwQbEnmodrYVg=="
  crossorigin="anonymous">
  </script>
<!-- 網址取參數_start -->
<script>
  //先取得網址字串，假設此頁網址為「index.aspx?id=U001&name=GQSM」
  var url = location.href;
  //再來用去尋找網址列中是否有資料傳遞(QueryString)
  if (url.indexOf('?') != -1) {
    //之後去分割字串把分割後的字串放進陣列中
    var ary1 = url.split('?');
    //此時ary1裡的內容為：
    //ary1[0] = 'index.aspx'，ary2[1] = 'id=U001&name=GQSM'
    //下一步把後方傳遞的每組資料各自分割
    var ary2 = ary1[1].split('&');
    //此時ary2裡的內容為：
    //ary2[0] = 'id=U001'，ary2[1] = 'name=GQSM'
    //最後如果我們要找id的資料就直接取ary[0]下手，name的話就是ary[1]
    var ary3 = ary2[0].split('=');
    //此時ary3裡的內容為：
    //ary3[0] = 'id'，ary3[1] = 'U001'
    //取得id值
    var id = ary3[1];
    console.log(id)
  }
</script>
<!-- 網址取參數_end -->

<!-- API_start -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  crossorigin="anonymous"></script>

<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" crossorigin="anonymous"></script>
<script>
  // 分頁
  var data_table = [];
  $.extend(true, $.fn.dataTable.defaults, {
    paging: true,
    lengthChange: false,
    searching: false,
    processing: true,
    ordering: false,
    info: false,
    responsive: false,
    autoWidth: false,
    pageLength: 3,
    dom: '<"top"f>rtlip'
  });

  $("#table-data").DataTable({
    ajax: function (data, callback, settings) {
      axios
        .get("http://localhost:8081/roomorderDetial/3")
        .then((result) => {
          console.log(result)
          
          if (result.data.room_order_status && result.data.room_order_status !== 0){
            $(".btn-cancel-order").text("已入住");
          }
          callback({ data: result.data });
        })
        .catch((err) => {
          console.log(err);
        });
    },
    columns: [
      {
        data: null,
        render: function (data, type, row, meta) {
          return data.roomorder_id;
        }
      },
      {
        data: null,
        render: function (data, type, row) {
          return data.room_name;
        }
      },
      {
        data: null,
        render: function (data, type, row, meta) {
          return data.room_check_date;
        }
      },
      {
        data: null,
        render: function (data, type, row, meta) {
          return data.room_total_amount;
        }
      },

      {
  data: null,
  render: function (data, type, row, meta) {
    if (data.order_status) {
      if (data.room_order_status && data.room_order_status !== 0) {
        // 如果回傳資料中有 room_order_status，且其值不為 0，就修改取消訂單按鈕的文字內容為「已入住」
        return '<h6>訂單已成立</h6>';
      } else {
        return '<button type="button" class="btn btn-outline-warning btn-cancel-order">取消訂單</button>';
      }
    } else {
      return '<h6>已取消</h6>';
    }
  }
},

      // {
      //   data: null,
      //   render: function (data, type, row, meta) {
      //     if (data.order_status) {
      //       return '<button type="button" class="btn btn-outline-warning btn-cancel-order">取消訂單</button>';
      //     } else {
      //       return '<h6>已取消</h6>';
      //     }
      //     // order_status
      //   }
      // },
      

    ]
  });
  // API刷新
  $(document).on("click", ".btn-edit", function () {
    let current_row = $(this).parents("tr");
    if (current_row.hasClass("child")) {
      current_row = current_row.prev();
    }
    let table = $("#table-data").DataTable();
    let data = table.row(current_row).data();
    let modal = $('#exampleModal')
    modal.find('.modal-title').text(data.email);
    modal.find('#memberId').val(data.name);

  });

  const refreshTable = (tablename) => {
    let table = $(tablename).DataTable();
    table.ajax.reload(null, false);
  };

  const drawTable = (tablename, obj) => {
    let xtable = $(tablename).DataTable();
    xtable.clear();
    xtable.rows.add(obj);
    xtable.draw();
  };
</script>
<!-- API_end-->
<!-- comment button_start-->

<!-- cancel order button_start-->
<script>
  $(document).on("click", ".btn-cancel-order", function (e) {
    console.log(e)
    // 取data
    let current_row = $(this).parents("tr");
    if (current_row.hasClass("child")) {
      current_row = current_row.prev();
    }
    let table = $("#table-data").DataTable();
    let data = table.row(current_row).data();
    var roomorder_id = data.roomorder_id;
    var datailRoom = {};


    console.log(datailRoom)
    data['memberId'] = '1';
    swal({
      title: `${data.room_name}`,
      text: "確定要取消此筆訂單?",
      type: "warning",
      cancelButtonText: '取消',
      confirmButtonText: "確定",
      showCancelButton: true
    }).then((result) => {
      if (result.value) {
        $.ajax({
          type: "GET",
          url: `http://localhost:8081/roomorders/${roomorder_id}`,
          dataType: "json",
          encode: true
        }).done(function (data) {
          console.log(data)
          datailRoom = data;
          datailRoom.orderStatus = '0';
          datailRoom.roomCheckInDate = '2020-01-01';
          datailRoom.roomCheckOutDate = '2020-01-01';
          delete datailRoom.roomorder_id;
          $.ajax({
            type: "PUT",
            url: `http://localhost:8081/roomordersCancel/${roomorder_id}`,
            data: JSON.stringify(datailRoom),
            contentType: "application/json",
            encode: true
          }).done(function (data) {
            console.log(data)
            swal({
              type: "success",
              title: "取消成功!",
            });
            refreshTable("#table-data");

          });
        }).fail(function (error) {
          console.log(error);
        });

      }
    });
  });
</script>

<!-- cancel order button_end-->
<!-- model -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
  integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous">
  </script>
